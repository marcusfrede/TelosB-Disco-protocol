clc;
clear all;

%Simulation
%Prime pair i
pi1 = 37;
pi2 = 43;

%Prime pair j
pj1 = 37;
pj2 = 43;

cycles = 100000;
hits = 0;
for n = 1:cycles
  nOffset = n+1;
  node1_turn_on = ((mod(n, pi1) == 0) || (mod(n, pi2) == 0));
  node2_turn_on = ((mod(nOffset, pj1) == 0) || (mod(nOffset, pj2) == 0));
  
  if node1_turn_on && node2_turn_on
    hits = hits + 1;
  end
end

chanceOfHit = hits/cycles;
numOfCyclesPrHit = 1/chanceOfHit;

i = 1;
chance = 0;
while chance < 0.96
     chance = 1-(1-(1/numOfCyclesPrHit))^(i);
     chanceArray(i) = chance;
     i = i + 1;
end
timeslots = 1:i-1;

figure(1)
plot(timeslots./50,chanceArray)
grid on
legendInfo{1} = ['Simulated Disco pp_i=(' num2str(pi1) ',' num2str(pi2) '), pp_j=(' num2str(pj1) ',' num2str(pj2) ')'];
h_legend = legend(legendInfo, 'Location','SouthEast');
set(h_legend,'FontSize',15);
title('Balanced Symmetric Prime Pairs (simulation)')
xlabel('Discovery latency (s)', 'FontSize', 15)
ylabel('Fraction of Discoveries', 'FontSize', 15)
set(gca,'FontSize',15)

%% Test data in milliseconds
% simMilli = [13780 1720 620 2960 760 6660 160 12400 3720 2800 7740 8680 3720 3100 11160 4960 3720 6820 2040 7420 1700 1240 3720 10540 8680 2480 3440 7420 4640 4960 3720 2480 15500 500 740 3720 1900 1060 3240 9480 3540 2480 1240 9920 1900 7400 3720 1600 880 11160 1740 3840 3720 5160 1040 6380 4780 1860 3720 1300 8620 5160 4140 1860 360 1500 13640 5580 3720 1000 860 12920 4440 2980 740 5580 13640 1860 1860 700 7420 1180 5180 1060 3680 5580 11160 6220 3700 400 1060 4120 3300 5300 2560 2480 3720 9300 8440 1480];
simMilli = [23240 4140 1000 26660 4180 63620 22500 4160 1000 31840 4140 5180 17320 5160 4160 22500 5160 4160 27660 9340 22480 31820 4160 5180 17320 5160 4160 5180 22480 4160 5180 22480 4160 27660 4160 22500 5160 4160 5180 17320 5160 4160 5180 22480 4160 5180 17320 5160 4160 27660 4160 5180 17320 5160 4160 5180 22480 4160 5180 17320 5160 4160 5180 17320 5160 4160 5180 17320 5160 4160 5180 17320 5160 4160 5180 17320 5160 4160 22500 5160 4160 5180 17320 5160 4160 5180 17320 5160 4160 5180 17320 5160 4160 5180 17320 5160 4160 5180 17320 5160 4160 5180 17320 5160 4160 5180 17320 5160 4160 5180 17320 5160 4160 5180 17320 5160 4160 5180 17320 5180 4160 5160 17320 5160 4180 5160 17320 5160 12040 5180 7660 5180 13800 3400 17320 5180 9320 22500 4140 5180 17320 5160 9340 17320 5160 4160 22500 37000 4140 5180 17320 9320 5180 22480 9340 17320 9320 5180 17320 5180 26640 5180 9320 17320 9340 5160 22500 9320 17320 14500 31820 17320 14500 17320 14520 12140 5160 19680 6980 5160 14500 17320 14500 31820 17320 14500 5180 6980 5160 14500 5180 12140 14500 17320 14500 5180 12140 14500 17320 14500 5180 6980 5160 14500 12160 5160 14500 5180 6980 5160 14500 5180 6980 5160 14500 17320 14500 5180 6980 5160 14500 5180 6980 5160 14500 5180 6980 5160 14500 5180 6980 5160 14500 5180 6980 5160 14500 5180 6980 5160 14500 5180 6980 5160 14500 5180 6980 5160 8580 8620 18020 5180 8640 3380 12160 5160 14500 5180 6980 5180 14500 5160 6980 5160 14520 5160 6980 5160 14520 5160 6980 19680 5160 6980 5180 14480 5180 6980 5160 19680 6980 19660 5180 6980 5160 19680 6980 24840 6980 24840 6980 5180 14480 5180 6980 24840 6980 24840 6980 5180 19660 6980 24840 31820 7000 31800 24840 6980 56660 5180 1800 24840 31820 31820 5180 1800 24840 1820 36980 24840 5180 26640 6980 24840 6980 24840 5180 1800 24840 1820 5160 24840 5180 1800 24840 5180 1800 24840 1820 3360 1800 24840 6980 24840 1820 5160 24840 1820 3360 1800 24840 5180 1800 24840 1820 3360 1800 12040 860 840 1740 860 860 860 860 1720 860 860 860 860 860 860 860 860 860 860 860 860 860 1720 860 1720 1720 1720 860 860 860 1720 860 840 880 860 860 860 860 1720 860 860 860 1720];

milliSecondsPerCycle = 20;
simCycles = simMilli./milliSecondsPerCycle;

close all
figure(1)
cdfplot(simCycles./50)
set(gcf,'DefaultLineLineWidth',2);
hold on
plot(timeslots./50,chanceArray, '--', 'LineWidth', 2)
grid on
legendInfo{1} = ['Empirical Disco pp_i=(' num2str(pi1) ',' num2str(pi2) '), pp_j=(' num2str(pj1) ',' num2str(pj2) ')'];
legendInfo{2} = ['Simulated Disco pp_i=(' num2str(pi1) ',' num2str(pi2) '), pp_j=(' num2str(pj1) ',' num2str(pj2) ')'];
h_legend = legend(legendInfo, 'Location','SouthEast');
set(h_legend,'FontSize',15);
title('Balanced Symmetric Prime Pairs (test 1)')
xlabel('Discovery latency (s)', 'FontSize', 15)
ylabel('Fraction of Discoveries', 'FontSize', 15)
set(gca,'FontSize',15)

%% Other stuff
% Dutycycles
DutycycleM_i = 1/pi1+1/pi2;
DutycycleM_j = 1/pj1+1/pj2;